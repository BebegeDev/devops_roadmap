
Преобразование типов необходимо, когда нужно обработать значение одного типа так, как если бы оно было другого типа. Go — язык со статической типизацией, то есть тип каждой переменной известен во время компиляции. Такая строгость помогает избежать ошибок, но также означает, что вы не можете просто использовать значения разных типов как взаимозаменяемые. В этом уроке мы рассмотрим, как преобразовывать строки в числа и наоборот. Это распространённая задача во многих приложениях, например при обработке пользовательского ввода или чтении данных из файлов. Мы рассмотрим функции, доступные в стандартной библиотеке Go для таких преобразований, а также обсудим возможные ошибки и способы их устранения.

## Преобразование строк в числа

В пакете `strconv` языка Go есть функции для преобразования строк в различные числовые типы. Эти функции возвращают как преобразованное значение, так и сообщение об ошибке, что крайне важно для обработки ошибок.

### `strconv.Atoi()`

Функция `Atoi` (сокращение от «преобразование ASCII в целое число») используется для преобразования строки в `int`.

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	str := "123"
	num, err := strconv.Atoi(str)
	if err != nil {
		fmt.Println("Error converting string to integer:", err)
		return
	}
	fmt.Printf("The integer value is: %d\n", num) // Output: The integer value is: 123
	fmt.Printf("The type of num is: %T\n", num)   // Output: The type of num is: int

	// Example with an invalid string
	str = "abc"
	num, err = strconv.Atoi(str)
	if err != nil {
		fmt.Println("Error converting string to integer:", err) // Output: Error converting string to integer: strconv.Atoi: parsing "abc": invalid syntax
		return
	}
	fmt.Println(num)
}
```

В этом примере `strconv.Atoi("123")` успешно преобразует строку «123» в целое число 123. В этом случае переменная `err` будет равна `nil`, что означает отсутствие ошибки. Однако при попытке преобразовать «abc» `strconv.Atoi` возвращает ошибку, поскольку «abc» не является допустимым целым числом. Ошибка выводится на консоль.

### `strconv.ParseInt()`

Функция `ParseInt` более универсальна, чем `Atoi`, поскольку позволяет указать основание (например, двоичное, десятичное, шестнадцатеричное) и разрядность результирующего целого числа.

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	str := "101010"
	num, err := strconv.ParseInt(str, 2, 64) // Convert from base 2 (binary) to int64
	if err != nil {
		fmt.Println("Error converting string to integer:", err)
		return
	}
	fmt.Printf("The integer value is: %d\n", num) // Output: The integer value is: 42
	fmt.Printf("The type of num is: %T\n", num)   // Output: The type of num is: int64

	// Example with base 16 (hexadecimal)
	str = "FF"
	num, err = strconv.ParseInt(str, 16, 64)
	if err != nil {
		fmt.Println("Error converting string to integer:", err)
		return
	}
	fmt.Printf("The integer value is: %d\n", num) // Output: The integer value is: 255

	// Example with bit size
	str = "255"
	num, err = strconv.ParseInt(str, 10, 8) // Convert to int8 (8-bit integer)
	if err != nil {
		fmt.Println("Error converting string to integer:", err)
		return
	}
	fmt.Printf("The integer value is: %d\n", num) // Output: The integer value is: 255
	fmt.Printf("The type of num is: %T\n", int8(num))   // Output: The type of num is: int8

	//Example with a number too large for the specified bit size
	str = "256"
	_, err = strconv.ParseInt(str, 10, 8) // Try to convert to int8
	if err != nil {
		fmt.Println("Error converting string to integer:", err) // Output: Error converting string to integer: strconv.ParseInt: parsing "256": value out of range
		return
	}
}
```

Функция `ParseInt` принимает три аргумента: строку для преобразования, основание и размер в битах. Размер в битах определяет тип возвращаемого целого числа (0, 8, 16, 32 или 64, что соответствует `int`, `int8`, `int16`, `int32` и `int64` соответственно). Если bitSize равен 0, тип результата будет `int`.

### `strconv.ParseFloat()`

Чтобы преобразовать строку в число с плавающей запятой (`float32` или `float64`), можно использовать функцию `ParseFloat` .

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	str := "3.14159"
	num, err := strconv.ParseFloat(str, 64) // Convert to float64
	if err != nil {
		fmt.Println("Error converting string to float:", err)
		return
	}
	fmt.Printf("The float value is: %f\n", num) // Output: The float value is: 3.141590
	fmt.Printf("The type of num is: %T\n", num)   // Output: The type of num is: float64

	// Example converting to float32
	str = "3.14159"
	numFloat32, err := strconv.ParseFloat(str, 32) // Convert to float32
	if err != nil {
		fmt.Println("Error converting string to float:", err)
		return
	}
	fmt.Printf("The float32 value is: %f\n", float32(numFloat32)) // Output: The float32 value is: 3.141590
	fmt.Printf("The type of numFloat32 is: %T\n", numFloat32)   // Output: The type of numFloat32 is: float64

	// Example with invalid string
	str = "abc"
	_, err = strconv.ParseFloat(str, 64)
	if err != nil {
		fmt.Println("Error converting string to float:", err) // Output: Error converting string to float: strconv.ParseFloat: parsing "abc": invalid syntax
		return
	}
}
```

Функция `ParseFloat` принимает строку для преобразования и размер в битах (32 для `float32`, 64 для `float64`).

### Обработка ошибок

При преобразовании строк в числа очень важно обрабатывать ошибки. Если строку невозможно преобразовать, эти функции вернут ошибку. Всегда проверяйте значение ошибки и обрабатывайте его соответствующим образом, чтобы программа не выдавала неверные результаты и не завершалась аварийно. Распространённые стратегии обработки ошибок:

- Вывод сообщения об ошибке на консоль.
- Возврат значения по умолчанию.
- Протоколирование ошибки.
- Выход из программы.

## Преобразование чисел в строки

В Go также есть функции для преобразования чисел в строки.

### `strconv.Itoa()`

Функция `Itoa` (сокращение от «целое число в ASCII») преобразует целое число в его строковое представление.

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	num := 123
	str := strconv.Itoa(num)
	fmt.Printf("The string value is: %s\n", str) // Output: The string value is: 123
	fmt.Printf("The type of str is: %T\n", str)   // Output: The type of str is: string
}
```

### `strconv.FormatInt()`

Функция `FormatInt` преобразует целое число в строку с указанным основанием.

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	num := int64(42)
	str := strconv.FormatInt(num, 2) // Convert to base 2 (binary)
	fmt.Printf("The binary string is: %s\n", str) // Output: The binary string is: 101010
	fmt.Printf("The type of str is: %T\n", str)   // Output: The type of str is: string

	// Example with base 16 (hexadecimal)
	num = 255
	str = strconv.FormatInt(num, 16)
	fmt.Printf("The hexadecimal string is: %s\n", str) // Output: The hexadecimal string is: ff
}
```

### `strconv.FormatFloat()`

Функция `FormatFloat` преобразует число с плавающей запятой в строку.

```go
package main

import (
	"fmt"
	"strconv"
)

func main() {
	num := 3.14159
	str := strconv.FormatFloat(num, 'f', 2, 64) // Format as a float with 2 decimal places
	fmt.Printf("The formatted float string is: %s\n", str) // Output: The formatted float string is: 3.14
	fmt.Printf("The type of str is: %T\n", str)   // Output: The type of str is: string

	// Different formatting options
	str = strconv.FormatFloat(num, 'e', 5, 64) // Scientific notation with 5 digits after the decimal point
	fmt.Printf("The scientific notation string is: %s\n", str) // Output: The scientific notation string is: 3.14159e+00

	str = strconv.FormatFloat(num, 'g', 5, 64) // General format with 5 significant digits
	fmt.Printf("The general format string is: %s\n", str) // Output: The general format string is: 3.1416
}
```

Функция `FormatFloat` принимает четыре аргумента: число для преобразования, формат ('f' для чисел с плавающей запятой, 'e' для экспоненциальной записи, 'g' для общего формата), точность (количество цифр после запятой или количество значащих цифр) и разрядность (32 или 64).

### Форматирование строки с помощью `fmt.Sprintf()`

В то время как функции `strconv` предназначены специально для преобразований, функция `fmt.Sprintf()` предоставляет более широкие возможности форматирования строк, включая преобразование чисел в строки.

```go
package main

import "fmt"

func main() {
	num := 123
	str := fmt.Sprintf("%d", num) // Convert integer to string
	fmt.Printf("The string value is: %s\n", str) // Output: The string value is: 123

	floatNum := 3.14159
	str = fmt.Sprintf("%.2f", floatNum) // Format float to 2 decimal places
	fmt.Printf("The formatted float string is: %s\n", str) // Output: The formatted float string is: 3.14
}
```

`fmt.Sprintf()` использует спецификаторы формата (например, `%d` для целых чисел, `%.2f` для чисел с плавающей запятой с двумя знаками после запятой), чтобы управлять преобразованием числа в строку.

## Практические Упражнения

1. **Преобразование температуры:** напишите программу, которая принимает температуру в градусах Цельсия в виде строки, преобразует её в число с плавающей запятой, а затем переводит в градусы Фаренгейта. Формула для перевода в градусы Фаренгейта: `(Celsius * 9/5) + 32`. Выведите температуру в градусах Фаренгейта на консоль с точностью до двух знаков после запятой. Учитывайте возможные ошибки при преобразовании строки в число с плавающей запятой.
2. **Преобразование двоичного числа в десятичное:** напишите функцию, которая принимает двоичное число в виде строки и преобразует его в десятичное. Убедитесь, что ваша функция обрабатывает некорректные двоичные строки (строки, содержащие символы, отличные от '0' и '1').
3. **Форматирование валюты:** напишите программу, которая принимает число с плавающей запятой, представляющее собой сумму денег, и форматирует его в виде строки с валютой (например, «$1 234,56»). Для форматирования можно использовать `fmt.Sprintf` .
4. **Шестнадцатеричный код цвета:** Напишите программу, которая принимает три целочисленных значения, представляющих красный, зелёный и синий компоненты цвета (от 0 до 255), и преобразует их в шестнадцатеричный код цвета (например, «#FF0000» для красного).

Эти упражнения помогут вам на практике освоить преобразование строк и чисел в Go, а также обработку возможных ошибок.

В этом уроке мы рассмотрели основные методы преобразования строк и чисел в Go. Вы узнали, как использовать функции из пакета `strconv`, такие как `Atoi`, `ParseInt`, `ParseFloat`, `Itoa`, `FormatInt` и `FormatFloat`. Вы также узнали, как использовать `fmt.Sprintf` для более общего форматирования строк. Обработка ошибок — важнейшая часть этих преобразований, и вы увидели примеры того, как проверять наличие ошибок и обрабатывать их.