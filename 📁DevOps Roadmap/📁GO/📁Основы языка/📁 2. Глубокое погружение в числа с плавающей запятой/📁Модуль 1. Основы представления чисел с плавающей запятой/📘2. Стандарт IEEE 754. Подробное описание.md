
Стандарт IEEE 754 — это основа представления чисел с плавающей запятой и работы с ними в компьютерах. Понимание этого стандарта крайне важно для всех, кто работает с числовыми вычислениями, поскольку он определяет правила представления действительных чисел в конечном двоичном формате. В этом уроке мы подробно рассмотрим стандарт IEEE 754, изучим принципы его разработки, компоненты и влияние на точность вычислений. Поняв этот стандарт, вы сможете писать более качественный и надёжный числовой код.

## История создания IEEE 754

До появления стандарта IEEE 754 представление чисел с плавающей запятой различалось в зависимости от компьютерной архитектуры. Отсутствие стандартизации приводило к несогласованности результатов вычислений, что затрудняло написание переносимого и надёжного программного обеспечения для вычислений. Стандарт IEEE 754, впервые опубликованный в 1985 году, был призван решить эти проблемы, обеспечив единообразный и последовательный способ представления чисел с плавающей запятой и выполнения арифметических операций с ними. Его повсеместное внедрение способствовало обеспечению совместимости и воспроизводимости результатов вычислений.

### Ключевые цели стандарта IEEE 754

Стандарт IEEE 754 был разработан с учётом нескольких ключевых целей:

- **Переносимость:** убедитесь, что вычисления с плавающей запятой дают одинаковые результаты на разных платформах.
- **Точность:** Обеспечьте представление, позволяющее точно аппроксимировать действительные числа в рамках ограниченной точности.
- **Обработка исключений:** определите, как последовательно обрабатывать исключительные ситуации, такие как деление на ноль или переполнение.
- **Эффективность:** Обеспечьте эффективную аппаратную и программную реализацию вычислений с плавающей запятой.

## Основные компоненты стандарта IEEE 754

Стандарт IEEE 754 определяет формат представления чисел с плавающей запятой, который состоит из трёх основных компонентов: знака, показателя степени и мантиссы (также известной как значащая часть).

### Знаковый бит

Знаковый бит указывает на то, является ли число положительным или отрицательным. Значение 0 соответствует положительному числу, а значение 1 — отрицательному. Это самый простой компонент представления чисел с плавающей запятой.

### Показатель степени

Показатель степени определяет масштаб или величину числа. Он хранится в смещённой форме, то есть к фактическому значению показателя степени добавляется постоянное смещение. Это позволяет представлять как положительные, так и отрицательные показатели степени без необходимости в отдельном знаковом бите для показателя степени.

#### Смещение показателя степени

Смещение выбирается таким образом, чтобы наименьший возможный показатель степени (все нули) представлял собой особое значение (либо ноль, либо денормализованное число, как мы увидим позже), а наибольший возможный показатель степени (все единицы) также представлял собой особые значения (бесконечность или NaN). Смещение обычно рассчитывается как 2(k-1) - 1, где _k_ — количество бит в поле показателя степени.

Например, в числах с одинарной точностью (float32) поле экспоненты имеет ширину 8 бит, поэтому смещение составляет 2(8-1) - 1 = 127. В числах с двойной точностью (float64) поле экспоненты имеет ширину 11 бит, поэтому смещение составляет 2(11-1) - 1 = 1023.

### Мантисса (знаменатель)

Мантисса, также известная как значащая часть, представляет собой биты точности числа. Она определяет значащие цифры числа с плавающей запятой. В стандарте IEEE 754 используется метод, называемый _нормализацией_, для увеличения количества значащих цифр, которые могут быть сохранены.

#### Нормализация и скрытый бит

В нормализованном числе с плавающей запятой мантисса представлена в виде 1._дробь_, где _дробь_ — это дробная часть мантиссы. Ведущая '1' не сохраняется явно, так как предполагается, что она всегда присутствует (за исключением особых случаев, таких как ноль и денормализованные числа). Эта неявная ведущая '1' называется _скрытым битом_ или _неявным ведущим битом_. Это позволяет хранить один дополнительный бит точности.

Например, если поле мантиссы имеет ширину 23 бита (как в числах с одинарной точностью), то эффективная точность составляет 24 бита из-за скрытого бита.

## Форматы IEEE 754: одинарной и двойной точности

Стандарт IEEE 754 определяет несколько форматов чисел с плавающей запятой, но наиболее часто используются форматы с одинарной точностью (float32) и двойной точностью (float64).

### Одинарная точность (float32)

Одинарная точность, также известная как float32, использует 32 бита для представления чисел с плавающей запятой. Формат следующий:

- Знаковый бит: 1 бит
- Показатель степени: 8 бит
- Мантисса: 23 бита

### Двойная точность (float64)

Двойная точность, также известная как float64, использует 64 бита для представления чисел с плавающей запятой. Формат следующий:

- Знаковый бит: 1 бит
- Показатель степени: 11 бит
- Мантисса: 52 бита

Двойная точность обеспечивает более высокую точность и более широкий диапазон представимых чисел по сравнению с одинарной точностью.

|Особенность|Одинарная точность (float32)|Двойная точность (float64)|
|---|---|---|
|Общее количество битов|32|64|
|Знаковые биты|1|1|
|Биты экспоненты|8|11|
|Кусочки мантиссы|23|52|
|Смещение экспоненты|127|1023|
|Приблизительный диапазон|От ±1,4 x 10-45 до ±3,4 x 1038|От ±4,9 x 10-324 до ±1,8 x 10308|
|Десятичная точность|~7 цифр|~15–17 цифр|

## Декодирование чисел с плавающей запятой IEEE 754

Чтобы понять, как представлены числа с плавающей запятой, давайте рассмотрим процесс декодирования числа в формате IEEE 754.

### Пример: декодирование числа с одинарной точностью (float32)

Рассмотрим следующее число с плавающей запятой одинарной точности, представленное в шестнадцатеричном формате: `0x42480000`

1. **Преобразование в двоичный формат:** Сначала преобразуем шестнадцатеричное представление в двоичное:
    
    `0x42480000 = 01000010010010000000000000000000`

2. **Определите компоненты:** определите знак, показатель степени и мантиссу:
    
    - Знак: `0` (положительный)
    - Показатель степени: `10000100`
    - Мантисса: `10010000000000000000000`
3. **Преобразуйте показатель степени:** преобразуйте показатель степени из двоичной системы в десятичную и вычтите смещение (127 для чисел с одинарной точностью):
    
    `10000100 = 132` `132 - 127 = 5` Таким образом, фактический показатель равен 5.
    
4. **Определите значение мантиссы:** добавьте скрытый бит (1) в начало мантиссы:
    
    `1.10010000000000000000000`
    
5. **Вычислите значение с плавающей запятой:** Вычислите значение с плавающей запятой по формуле:
    
    `(-1)^sign * 1.mantissa * 2^(exponent)` `(-1)^0 * 1.10010000000000000000000 * 2^5` `1 * 1.5625 * 32 = 50`
    

Таким образом, число с плавающей запятой `0x42480000` представляет десятичное значение 50.

### Пример: декодирование числа с двойной точностью (float64)

Рассмотрим следующее число с плавающей запятой двойной точности, представленное в шестнадцатеричном формате: `0x4024000000000000`

1. **Преобразование в двоичный формат:** Сначала преобразуем шестнадцатеричное представление в двоичное:
    
    `0x4024000000000000 = 0100000000100100000000000000000000000000000000000000000000000000`
    
2. **Определите компоненты:** определите знак, показатель степени и мантиссу:
    
    - Знак: `0` (положительный)
    - Показатель степени: `10000000010`
    - Мантисса: `0100000000000000000000000000000000000000000000000000`
3. **Преобразование экспоненты:** преобразуйте экспоненту из двоичной системы счисления в десятичную и вычтите смещение (1023 для двойной точности):
    
    `10000000010 = 1026` `1026 - 1023 = 3` Таким образом, фактический показатель равен 3.
    
4. **Определите значение мантиссы:** добавьте скрытый бит (1) в начало мантиссы:
    
    `1.010000000000000000000000000000000000000000000000000`
    
5. **Вычислите значение с плавающей запятой:** Вычислите значение с плавающей запятой по формуле:
    
    `(-1)^sign * 1.mantissa * 2^(exponent)` `(-1)^0 * 1.010000000000000000000000000000000000000000000000000 * 2^3` `1 * 1.25 * 8 = 10`
    

Таким образом, число с плавающей запятой `0x4024000000000000` представляет десятичное значение 10.

## Практические выводы и рекомендации

Понимание стандарта IEEE 754 крайне важно для написания надёжного числового кода. Вот несколько практических рекомендаций:

- **Ограниченная точность:** числа с плавающей запятой имеют ограниченную точность, то есть не все действительные числа могут быть представлены точно. Это может привести к ошибкам округления и неточностям в вычислениях.
- **Неассоциативность:** арифметика с плавающей запятой не всегда ассоциативна из-за ошибок округления. Это означает, что порядок операций может влиять на результат. Например, `(a + b) + c` может не равняться `a + (b + c)`.
- **Проблемы сравнения:** сравнение чисел с плавающей запятой на предмет равенства может быть проблематичным из-за ошибок округления. Обычно для сравнения чисел с плавающей запятой на предмет приблизительного равенства используется значение допуска (эпсилон). Подробнее об этом мы поговорим на следующем уроке.

## Упражнения

1. Преобразуйте следующие шестнадцатеричные значения с одинарной точностью в десятичные эквиваленты:
    - `0x00000000`
    - `0x3f800000`
    - `0xc0000000`
2. Преобразуйте следующие шестнадцатеричные значения с двойной точностью в десятичные эквиваленты:
    - `0x0000000000000000`
    - `0x3ff0000000000000`
    - `0xc000000000000000`
3. Объясните, почему вычисления с плавающей запятой не всегда ассоциативны. Приведите пример кода (на любом языке), иллюстрирующий это.
4. Изучите и объясните концепцию «денормализованных чисел» в стандарте IEEE 754. Для чего они нужны?

