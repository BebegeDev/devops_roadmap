
Числа с плавающей запятой — краеугольный камень современных вычислений, позволяющий представлять действительные числа и манипулировать ими в рамках ограниченной памяти компьютера. Они необходимы для широкого спектра приложений — от научного моделирования и финансового анализа до рендеринга графики и машинного обучения. Понимание того, как работают числа с плавающей запятой, каковы их ограничения и как их эффективно использовать, крайне важно для любого программиста или специалиста по обработке данных. В этом уроке мы рассмотрим фундаментальные концепции представления чисел с плавающей запятой и заложим основу для изучения более сложных тем в последующих модулях.

## Необходимость в числах с плавающей запятой

Компьютеры представляют данные с помощью битов, которые могут быть равны 0 или 1. Целые числа можно представить непосредственно в двоичной системе счисления. Однако для представления действительных чисел, которые включают дробную часть и числа, выходящие за пределы диапазона целых чисел, требуется другой подход. Числа с плавающей запятой позволяют представлять действительные числа с ограниченным объёмом памяти.

### Представление с фиксированной точкой: ограниченный подход

Одним из наивных подходов к представлению действительных чисел является _представление с фиксированной точкой_. В этом методе для целой части выделяется фиксированное количество бит, а для дробной части — фиксированное количество битов.

Например, если у нас есть 8 бит, мы можем выделить 4 бита для целой части и 4 бита для дробной части. Тогда двоичное число `0110.1010` будет соответствовать десятичному числу 6,625.

Однако представление с фиксированной точкой имеет существенные ограничения:

- **Ограниченный диапазон:** при фиксированном количестве бит для целочисленной части диапазон представимых чисел ограничен.
- **Ограниченная точность:** при фиксированном количестве бит для дробной части точность ограничена. Вы можете представлять числа только с определённым уровнем детализации.
- **Неэффективное использование памяти:** для представления как очень маленьких, так и очень больших чисел с достаточной точностью потребуется большое количество битов, что приведёт к неэффективному использованию памяти.

### Представление чисел с плавающей запятой: более гибкое решение

Представление чисел с плавающей запятой позволяет преодолеть ограничения представления чисел с фиксированной запятой за счёт использования подхода, схожего с экспоненциальной записью. Число с плавающей запятой состоит из трёх компонентов:

- **Знак:** указывает, является ли число положительным или отрицательным.
- **Показатель степени:** определяет величину (масштаб) числа.
- **Мантисса (также называемая значащей частью или дробной частью):** представляет собой значащие цифры числа.

Общая форма числа с плавающей запятой может быть представлена следующим образом:

`Sign * Mantissa * Base ^ Exponent`

Где:

- `Sign` Значение равно +1 или -1.
- `Mantissa` является дробным числом.
- `Base` Это основание системы счисления (обычно 2 для компьютеров).
- `Exponent` является целым числом.

При изменении показателя степени «точка» (десятичная или двоичная) может «плавать», что позволяет представлять широкий диапазон чисел с разной точностью.

## Как работают числа с плавающей запятой

Давайте на примере с основанием 10 покажем, как работают числа с плавающей запятой. Рассмотрим число 123,45. Мы можем представить его в экспоненциальном виде как:

`1.2345 * 10^2`

Здесь:

- Мантисса равна 1,2345.
- Основание равно 10.
- Показатель степени равен 2.

Точно так же число 0,000678 можно представить в виде:

`6.78 * 10^-4`

В двоичном представлении чисел с плавающей запятой основанием является число 2. Например, десятичное число 6,5 можно представить в двоичном виде как 110,1. В формате чисел с плавающей запятой оно будет нормализовано следующим образом:

`1.101 * 2^2`

Здесь:

- Мантисса равна 1,101 (в двоичной системе).
- Основание равно 2.
- Показатель степени равен 2 (десятичный).

### Нормализация

Нормализация — важнейший этап представления чисел с плавающей запятой. Она включает в себя корректировку мантиссы и показателя степени таким образом, чтобы мантисса имела определённую форму. Как правило, мантисса нормализуется таким образом, чтобы слева от десятичной точки (в десятичной системе счисления) была одна ненулевая цифра или слева от двоичной точки (в двоичной системе счисления) была одна единица. Эта начальная единица в двоичном представлении часто _неявна_ и фактически не сохраняется, обеспечивая один дополнительный бит точности.

### Пример: преобразование десятичной дроби в число с плавающей запятой (концептуально)

Давайте рассмотрим упрощённый пример преобразования десятичного числа в число с плавающей запятой (хотя реальная реализация более сложна и определяется стандартом IEEE 754, который мы рассмотрим позже).

Предположим, мы хотим представить десятичное число 5,625 в упрощённом формате с плавающей запятой:

- 1 бит для знака
- 3 бита для показателя степени
- 4 бита для мантиссы (без учёта неявной начальной единицы)

1. **Преобразование в двоичную систему:** 5,625 в десятичной системе счисления — это 101,101 в двоичной.
    
2. **Нормализация:** Нормализация двоичного числа: `1.01101 * 2^2`
    
3. **Определите знак:** число положительное, поэтому знаковый бит равен 0.
    
4. **Определите показатель степени:** Показатель степени равен 2. Нам нужно представить его с помощью 3 бит. Поскольку мы пока не рассматриваем смещения (это тема следующего урока), предположим, что мы можем напрямую представлять показатели степени со знаком. Итак, 2 в двоичной системе счисления — это `010`.
    
5. **Определите мантиссу:** мантисса равна 01101. Поскольку у нас есть только 4 бита для мантиссы (не считая неявной начальной единицы), мы отбрасываем последнюю цифру, в результате чего получается `0110`.
    
6. **Объедините компоненты:** Представление с плавающей запятой будет выглядеть так: `0 010 0110` (знак, показатель степени, мантисса).
    

**Важное примечание:** это упрощённый пример. В реальном стандарте IEEE 754 используется смещение для показателя степени, а нормализация и округление выполняются более сложными способами.

## Приложения в реальном мире

Числа с плавающей запятой широко используются в различных областях:

1. **Научные вычисления:** используются в симуляциях, моделировании физических явлений и анализе данных. Например, моделирование погодных условий, молекулярных взаимодействий или анализ астрономических данных в значительной степени зависят от вычислений с плавающей запятой.
2. **Финансовое моделирование:** используется для расчёта процентных ставок, цен на акции и других финансовых показателей. Банки и инвестиционные компании используют числа с плавающей запятой для выполнения сложных вычислений, связанных с управлением рисками, оптимизацией портфеля и торговыми стратегиями.
3. **Компьютерная графика:** используется для представления координат, цветов и преобразований в 3D-графике. Для создания реалистичных изображений и анимации требуются точные вычисления с использованием чисел с плавающей запятой.

### Гипотетический Сценарий

Представьте, что вы разрабатываете беспилотный автомобиль. Программное обеспечение автомобиля должно обрабатывать данные с датчиков (камер, лидаров, радаров), чтобы понимать, что происходит вокруг, и принимать решения. Для этого требуется выполнить множество вычислений, таких как:

- Расчёт расстояния до объектов.
- Прогнозирование траектории движения других транспортных средств.
- Регулировка скорости и рулевого управления автомобиля.

Все эти вычисления основаны на числах с плавающей запятой. Даже небольшие неточности в этих вычислениях могут привести к принятию неверных решений и возникновению потенциально опасных ситуаций. Поэтому для разработки безопасного и надёжного программного обеспечения для беспилотных автомобилей крайне важно хорошо разбираться в арифметике с плавающей запятой и её ограничениях.

## Упражнения

1. Преобразуйте десятичное число 10,75 в двоичное. Затем приведите его к виду, подходящему для представления чисел с плавающей запятой (т. е. `1.xxxxx * 2^exponent`).
2. Объясните, в чём заключается компромисс между использованием большего количества бит для экспоненты и большего количества бит для мантиссы в представлении чисел с плавающей запятой.
3. Изучите и кратко опишите реальную ситуацию, в которой ограничения чисел с плавающей запятой могут привести к значительным ошибкам.