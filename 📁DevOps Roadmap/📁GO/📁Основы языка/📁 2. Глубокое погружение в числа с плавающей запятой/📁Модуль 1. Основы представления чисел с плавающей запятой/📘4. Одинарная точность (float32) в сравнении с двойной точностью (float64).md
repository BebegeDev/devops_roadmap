Числа с плавающей запятой являются основой численных вычислений, и понимание различий между числами с одинарной точностью (`float32`) и числами с двойной точностью (`float64`) крайне важно для написания эффективных и точных программ на Go. В этом уроке мы подробно рассмотрим особенности этих двух типов данных, их представление, точность, объём занимаемой памяти и подходящие варианты использования. Мы будем опираться на базовые знания о стандарте IEEE 754 и компонентах знака, показателя степени и мантиссы, рассмотренных в предыдущих уроках, чтобы понять, чем отличается `float32` от `float64`.

## Точность и дальность действия

Основное различие между `float32` и `float64` заключается в их точности и диапазоне. Точность — это количество значащих цифр, которые они могут точно отобразить, а диапазон — это величина наибольшего и наименьшего чисел, которые они могут отобразить.

### Одинарная точность (float32)

- **Формат:** Использует 32 бита (4 байта) памяти.
- **Знак:** 1 бит
- **Экспонента:** 8 бит
- **Мантисса (знаменатель):** 23 бита (плюс неявный старший бит)
- **Точность:** примерно 7 знаков после запятой. Это означает, что `float32` может точно представлять числа с точностью до 7 знаков после запятой. При превышении этого значения могут возникать ошибки округления.
- **Диапазон:** примерно от ±1,4 x 10-45 до ±3,4 x 1038.

### Двойная точность (float64)

- **Формат:** Использует 64 бита (8 байт) памяти.
- **Знак:** 1 бит
- **Экспонента:** 11 бит
- **Мантисса (знаменатель):** 52 бита (плюс неявный старший бит)
- **Точность:** примерно 15–17 знаков после запятой. `float64` обеспечивает значительно более высокую точность, чем `float32`, позволяя более точно представлять числа с точностью до 15–17 знаков после запятой.
- **Диапазон:** примерно от ±4,9 x 10-324 до ±1,8 x 10308.

**Пример:**

Рассмотрим представление числа π (пи), которое имеет бесконечное количество знаков после запятой.

- В `float32` число π может быть записано как 3,1415927.
- В `float64` число π может быть записано как 3,141592653589793.

Представление в виде `float64` явно более точное.

**Гипотетический Сценарий:**

Представьте, что вы разрабатываете физическую модель. Если вы используете `float32` для вычислений, то со временем накопившиеся ошибки округления могут привести к значительным отклонениям от ожидаемых результатов, особенно в сложных моделях, включающих множество итераций. Использование `float64` позволит уменьшить эти ошибки и повысить точность моделирования.

## Объем памяти

`float64` требует в два раза больше памяти, чем `float32`. Это может быть важным фактором при работе с большими массивами или структурами данных, особенно в условиях ограниченного объёма памяти.

**Пример:**

Если у вас есть массив из 1 миллиона чисел с плавающей запятой:

- При использовании `float32` массив будет занимать примерно 4 МБ памяти.
- При использовании `float64` массив будет занимать примерно 8 МБ памяти.

**Применение в реальном мире:**

В машинном обучении часто используются большие наборы данных. Если вы храните миллионы векторов признаков, использование `float32` вместо `float64` может вдвое сократить необходимый объём памяти, что потенциально позволит вам разместить весь набор данных в памяти или снизить затраты на облачное хранилище. Однако это приводит к снижению точности, что может повлиять на качество вашей модели.

## Соображения по производительности

Как правило, операции `float32` могут выполняться быстрее, чем операции `float64`, особенно на оборудовании, оптимизированном для арифметических операций с одинарной точностью. Однако на современных процессорах, которые хорошо оптимизированы для обоих типов операций, разница в производительности часто незначительна. При выборе между `float32` и `float64` в первую очередь следует руководствоваться требованиями к точности, а не производительностью, если только профилирование не выявит серьёзное узкое место.

**Пример:**

На некоторых старых графических процессорах или встроенных системах `float32` вычисления могут выполняться значительно быстрее из-за аппаратных ограничений. Однако на современных процессорах с инструкциями SIMD (Single Instruction, Multiple Data) разница в производительности зачастую минимальна.

## Выбор между float32 и float64

Выбор между `float32` и `float64` зависит от конкретного приложения и компромисса между точностью, использованием памяти и производительностью.

**Инструкция:**

- **По умолчанию используйте `float64`:** Если у вас нет особых причин использовать `float32`, то `float64` будет лучшим выбором из-за его более высокой точности. Это особенно важно для научных вычислений, финансовых расчётов и других областей, где точность имеет решающее значение.
- **Рассмотрите `float32` для сред с ограниченным объемом памяти:** Если вы работаете с большими наборами данных или у вас ограниченный объем памяти, `float32` может стать подходящим вариантом. Однако тщательно оцените его влияние на точность.
- **Проанализируйте свой код:** Если вас беспокоит производительность, проанализируйте свой код с помощью `float32` и `float64`, чтобы определить, есть ли существенная разница.
- **Помните о возможных ошибках округления:** независимо от того, используете ли вы `float32` или `float64`, помните о возможных ошибках округления и принимайте меры для их устранения, о чём мы поговорим в следующем модуле.

**Примеры из реального мира:**

1. **Графика и разработка игр:** `float32` часто используется в графике и разработке игр, поскольку позволяет значительно повысить производительность, а потеря точности зачастую допустима. Визуальные артефакты, вызванные незначительными ошибками округления, часто незаметны для человеческого глаза.
2. **Финансовые расчёты:** `float64` обычно используются для финансовых расчётов, поскольку точность имеет первостепенное значение. Даже небольшие ошибки округления могут привести к значительным финансовым последствиям.
3. **Научное моделирование:** выбор зависит от конкретного моделирования. Для моделирования, требующего высокой точности, например для моделирования климата, `float64` необходим. Для менее требовательных к точности моделей `float32` может быть достаточно.

## Упражнения

1. Напишите программу на Go, которая вычисляет площадь круга, используя `float32` и `float64` для радиуса. Сравните результаты для разных значений радиуса, включая очень большие и очень маленькие числа. Обратите внимание на разницу в точности.
2. Создайте большой массив (например, из 1 миллиона элементов) случайных чисел с плавающей запятой, используя `float32` и `float64`. Измерьте объём памяти, занимаемый каждым массивом.
3. Выполните простое итеративное вычисление (например, сложение ряда) с использованием `float32` и `float64`. Выполните вычисление для большого количества итераций и сравните конечные результаты. Обратите внимание на то, как по-разному накапливаются ошибки округления в каждом случае.